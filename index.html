<!DOCTYPE html>
<html lang="es"> 
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HMI Flow-Pack Compacta</title>
    <link rel="stylesheet" href="flowpack_style.css">
    <!-- Using Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="hmi-container">
        <!-- Header / Status Bar (Always visible except maybe start screen) -->
        <header class="hmi-header" id="main-header" style="display: none;">
            <div class="header-left">
                <span class="machine-status-indicator" id="header-status-indicator"></span>
                <span id="header-status-text">DETENIDA</span>
            </div>
            <div class="header-center">
                <span>Envasadora Flow-Pack</span>
            </div>
            <div class="header-right">
                <span id="header-datetime">--/--/-- --:--</span>
                <div class="plc-status">PLC: <span class="status-run">RUN</span></div>
            </div>
        </header>

        <!-- SCREENS -->
        
        <!-- 1) PANTALLA DE INICIO -->
        <div id="screen-start" class="screen active">
            <div class="start-content">
                <h1>Envasadora Flow-Pack Compacta ‚Äì Proyecto Final</h1>
                <div class="logo-placeholder">
                    <i class="fas fa-industry fa-3x"></i>
                </div>
                <div class="plc-indicator-start">
                    Estado PLC: <span class="status-run">RUN</span>
                </div>
                <div class="datetime-start" id="start-datetime">--/--/-- --:--</div>
                <button class="btn-primary btn-large" onclick="navigateTo('screen-home')">INGRESAR</button>
            </div>
        </div>

        <!-- 2) PANTALLA PRINCIPAL DE OPERACI√ìN (HOME) -->
        <div id="screen-home" class="screen">
            <div class="main-layout">
                <div class="control-column">
                    <button class="btn-start" id="btn-start" onclick="startMachine()">START</button>
                    <button class="btn-stop" id="btn-stop" onclick="stopMachine()">STOP</button>
                    <button class="btn-reset" onclick="resetMachine()">RESET</button>
                </div>
                
                <div class="visualization-column">
                    <!-- New Status Lamps Section -->
                    <div class="status-lamps">
                        <div class="lamp" id="lamp-run">
                            <div class="lamp-circle green"></div>
                            <span>EN MARCHA</span>
                        </div>
                        <div class="lamp" id="lamp-stop">
                            <div class="lamp-circle red on"></div>
                            <span>DETENIDA</span>
                        </div>
                        <div class="lamp" id="lamp-alarm">
                            <div class="lamp-circle yellow"></div>
                            <span>ALARMA</span>
                        </div>
                    </div>

                    <div class="process-graphic">
                        <!-- Simple CSS graphic representation -->
                        <div class="conveyor-belt">
                            <div class="product" id="anim-product-1"></div>
                            <div class="product" id="anim-product-2"></div>
                        </div>
                        <div class="sealing-jaws-vertical"></div>
                        <div class="sealing-jaws-horizontal"></div>
                        <div class="sensor-visual" id="vis-sensor-prod"></div>
                    </div>
                    
                    <div class="realtime-values">
                        <div class="value-card">
                            <label>Temp. Long.</label>
                            <span class="value" id="val-temp-long">0.0</span> <span class="unit">¬∞C</span>
                        </div>
                        <div class="value-card">
                            <label>Temp. Trans.</label>
                            <span class="value" id="val-temp-trans">0.0</span> <span class="unit">¬∞C</span>
                        </div>
                        <div class="value-card">
                            <label>Velocidad</label>
                            <span class="value" id="val-speed">0</span> <span class="unit">m/min</span>
                        </div>
                    </div>
                </div>

                <div class="stats-column">
                    <div class="production-counter">
                        <label>Producci√≥n (Alfajores)</label>
                        <div class="counter-display" id="val-production">0</div>
                        <button class="btn-small-action" onclick="resetCounter()">Reset Contador</button>
                    </div>
                    
                    <div class="home-navigation">
                        <button class="nav-btn-home" onclick="navigateTo('screen-params')">
                            <i class="fas fa-sliders-h"></i> Par√°metros
                        </button>
                        <button class="nav-btn-home" onclick="navigateTo('screen-alarms')">
                            <i class="fas fa-bell"></i> Alarmas
                        </button>
                        <button class="nav-btn-home" onclick="navigateTo('screen-manual')">
                            <i class="fas fa-tools"></i> Manual
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 3) PANTALLA DE PAR√ÅMETROS DEL PROCESO -->
        <div id="screen-params" class="screen">
            <div class="screen-header">
                <h2>Par√°metros del Proceso</h2>
                <button class="btn-back" onclick="navigateTo('screen-home')"><i class="fas fa-arrow-left"></i> Volver a Operaci√≥n</button>
            </div>
            <div class="params-grid">
                <div class="param-item">
                    <label>Temp. Sellado Long. (¬∞C)</label>
                    <div class="control-input">
                        <button class="btn-adjust" onclick="adjustParam('set-temp-long', -1)">-</button>
                        <input type="number" id="set-temp-long" value="120" min="0" max="200">
                        <button class="btn-adjust" onclick="adjustParam('set-temp-long', 1)">+</button>
                    </div>
                </div>
                <div class="param-item">
                    <label>Temp. Sellado Trans. (¬∞C)</label>
                    <div class="control-input">
                        <button class="btn-adjust" onclick="adjustParam('set-temp-trans', -1)">-</button>
                        <input type="number" id="set-temp-trans" value="130" min="0" max="200">
                        <button class="btn-adjust" onclick="adjustParam('set-temp-trans', 1)">+</button>
                    </div>
                </div>
                <div class="param-item">
                    <label>Velocidad Cinta (m/min)</label>
                    <div class="control-input">
                        <button class="btn-adjust" onclick="adjustParam('set-speed', -1)">-</button>
                        <input type="number" id="set-speed" value="15" min="0" max="100">
                        <button class="btn-adjust" onclick="adjustParam('set-speed', 1)">+</button>
                    </div>
                </div>
                <div class="param-item">
                    <label>Longitud Paquete (mm)</label>
                    <div class="control-input">
                        <button class="btn-adjust" onclick="adjustParam('set-length', -5)">-</button>
                        <input type="number" id="set-length" value="100" min="50" max="500">
                        <button class="btn-adjust" onclick="adjustParam('set-length', 5)">+</button>
                    </div>
                </div>
                <div class="param-item">
                    <label>Retardo Cuchilla (ms)</label>
                    <div class="control-input">
                        <button class="btn-adjust" onclick="adjustParam('set-delay', -10)">-</button>
                        <input type="number" id="set-delay" value="50" min="0" max="1000">
                        <button class="btn-adjust" onclick="adjustParam('set-delay', 10)">+</button>
                    </div>
                </div>
            </div>
            <div class="action-buttons">
                <button class="btn-primary" onclick="saveParams()">Guardar Par√°metros</button>
            </div>
        </div>

        <!-- 4) PANTALLA DE ALARMAS Y DIAGN√ìSTICO -->
        <div id="screen-alarms" class="screen">
            <div class="screen-header">
                <h2>Alarmas y Diagn√≥stico</h2>
                <button class="btn-back" onclick="navigateTo('screen-home')"><i class="fas fa-arrow-left"></i> Volver a Operaci√≥n</button>
            </div>
            
            <!-- Simulation Controls for Demo -->
            <div class="debug-panel" style="background:#fff3cd; padding:10px; border:1px solid #ffeeba; margin-bottom:15px; border-radius: 5px;">
                <strong style="display:block; margin-bottom:5px; color:#856404;">üõ†Ô∏è PANEL DE SIMULACI√ìN DE FALLAS (DEMO)</strong>
                <div style="display:grid; grid-template-columns: repeat(2, 1fr); gap:5px;">
                    <button class="btn-small-action" onclick="triggerAlarm('Falta de film/papel')">Falta Film</button>
                    <button class="btn-small-action" onclick="triggerAlarm('Producto mal posicionado')">Prod. Mal Pos.</button>
                    <button class="btn-small-action" onclick="triggerAlarm('Sobretemperatura en selladores')">Sobretemperatura</button>
                    <button class="btn-small-action" onclick="triggerAlarm('Falla en variador de frecuencia')">Falla Variador</button>
                    <button class="btn-small-action" onclick="triggerAlarm('Falla en mordazas de corte')">Falla Mordazas</button>
                    <button class="btn-small-action" style="background:#dc3545; color:white;" onclick="triggerAlarm('Parada de emergencia activada')">PARADA EMERGENCIA</button>
                </div>
            </div>

            <div class="alarms-list" id="alarms-list">
                <!-- Alarms will be injected here -->
            </div>
            <div class="alarm-controls">
                <button class="btn-warning" onclick="resetAlarms()">Reset Alarmas</button>
            </div>
        </div>

        <!-- 5) PANTALLA DE MODO MANUAL / MANTENIMIENTO -->
        <div id="screen-manual" class="screen">
            <div class="screen-header">
                <h2>Modo Manual / Mantenimiento</h2>
                <button class="btn-back" onclick="navigateTo('screen-home')"><i class="fas fa-arrow-left"></i> Volver a Operaci√≥n</button>
            </div>
            <div class="manual-grid">
                <div class="manual-group">
                    <h3>Actuadores</h3>
                    <div class="toggle-item">
                        <label>Cinta Transportadora</label>
                        <button class="btn-toggle" id="man-belt" onclick="toggleManual('man-belt')">OFF</button>
                    </div>
                    <div class="toggle-item">
                        <label>Avance Film</label>
                        <button class="btn-toggle" id="man-film" onclick="toggleManual('man-film')">OFF</button>
                    </div>
                    <div class="toggle-item">
                        <label>Cuchilla Transversal</label>
                        <button class="btn-toggle" id="man-knife" onclick="toggleManual('man-knife')">ACTUAR</button>
                    </div>
                    <div class="toggle-item">
                        <label>Resistencias</label>
                        <button class="btn-toggle" id="man-heat" onclick="toggleManual('man-heat')">OFF</button>
                    </div>
                </div>
                <div class="manual-group">
                    <h3>Sensores (Estado)</h3>
                    <div class="sensor-item">
                        <span class="sensor-indicator off" id="sens-product"></span>
                        <label>Sensor Producto</label>
                    </div>
                    <div class="sensor-item">
                        <span class="sensor-indicator on" id="sens-film"></span>
                        <label>Sensor Film</label>
                    </div>
                    <div class="sensor-item">
                        <span class="sensor-indicator off" id="sens-limit"></span>
                        <label>Finales de Carrera</label>
                    </div>
                </div>
            </div>
            <div class="safety-warning">
                <i class="fas fa-exclamation-triangle"></i> PRECAUCI√ìN: El modo manual anula ciertas seguridades autom√°ticas.
            </div>
        </div>

        <!-- Navigation Footer (Visible only if specifically needed, but now main nav is on Home) -->
        <!-- User requested Home screen only after login, and specific nav buttons on Home. 
             We will keep a minimal footer or hide it to respect the "explicit return" rule. 
             Actually, the prompt says "Once navigating to other screen, do not return automatically... except via explicit button".
             The buttons added to screens (Back to Operation) handle this.
             So we can REMOVE the global footer to strictly follow the prompt. -->
        <!-- <nav class="hmi-nav" id="main-nav" style="display: none;"> ... </nav> -->
    </div>

    <script src="flowpack_script.js"></script>
</body>
</html>
